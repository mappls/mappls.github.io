TrendDays is a project I did for a client trading in the stock market. It's a pure ML project where, given a stock, we were looking to predict a certain type of day, called "Trend" day. That is, how the rest of the day will develop, given its start in the morning. The earlier in the day we have a good prediction, the better.

## The data

The client had collected the needed data over a couple of years long period. Still, some features of the data were collected (and calculated) in a different way throughout the years, so we needed to run a couple of experiments on which parts of the data have biggest predictive power. At the end, we were left with just around 700 sample days, or roughly 3 years data. 

## Modeling & evaluation

We setup the problem as a binary classification one, where Trend days occupied around 10% of the total observed days. With our targets being skewed, we chose evaluation through precision / recall metrics, and the F1-score, as the harmonic mean of the two.

After some initial tests with a few quick models from the `scikit-learn` library, we decided to go with two types of neural networks:

- a standard feed-forward one (call it Dense),
- a Long-Short Term Memory (LSTM) network.

The two networks were built using `Keras`, and all evaluations were conducted using repeated k-fold cross-validation, due to the lack of data.

## Results

After optimising the parameters of the Dense and LSTM models, it turned out that the LSTM one has better performance. Finally it was in the client's interest to maximise the recall metric, at the expense of a smaller precision. That is, to get a more "risky" model. This was achieved through adjusting the decision threshold, and provided satisfying results. 

<div><script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script src="https://cdn.plot.ly/plotly-latest.min.js"></script><div id="18d7f961-d11a-4f4f-8528-ee9d383bc946" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("18d7f961-d11a-4f4f-8528-ee9d383bc946", [{"mode": "lines+markers", "name": "precision", "x": ["09:15:00", "09:30:00", "09:45:00", "10:00:00", "10:15:00", "10:30:00", "10:45:00", "11:00:00", "11:15:00", "11:30:00", "11:45:00", "12:00:00", "12:15:00", "12:30:00", "12:45:00", "13:00:00", "13:15:00", "13:30:00", "13:45:00", "14:00:00", "14:15:00", "14:30:00", "14:45:00", "15:00:00", "15:15:00", "15:30:00", "15:45:00", "16:00:00"], "y": [0.2196969696969697, 0.2569444444444444, 0.27586206896551724, 0.3161290322580645, 0.345, 0.34104046242774566, 0.4025157232704403, 0.32456140350877194, 0.43455497382198954, 0.52, 0.506578947368421, 0.5405405405405406, 0.5317919075144508, 0.5251396648044693, 0.5654761904761905, 0.6381578947368421, 0.5950920245398773, 0.6, 0.6206896551724138, 0.6449704142011834, 0.63125, 0.6282051282051282, 0.6405228758169934, 0.6551724137931034, 0.618421052631579, 0.6329113924050633, 0.6598639455782312, 0.610062893081761], "type": "scatter", "uid": "386db4bf-fcbf-4864-82ab-a74324c94eed"}, {"mode": "lines+markers", "name": "recall", "x": ["09:15:00", "09:30:00", "09:45:00", "10:00:00", "10:15:00", "10:30:00", "10:45:00", "11:00:00", "11:15:00", "11:30:00", "11:45:00", "12:00:00", "12:15:00", "12:30:00", "12:45:00", "13:00:00", "13:15:00", "13:30:00", "13:45:00", "14:00:00", "14:15:00", "14:30:00", "14:45:00", "15:00:00", "15:15:00", "15:30:00", "15:45:00", "16:00:00"], "y": [0.23387096774193547, 0.29838709677419356, 0.3225806451612903, 0.3951612903225806, 0.5564516129032258, 0.47580645161290325, 0.5161290322580645, 0.5967741935483871, 0.6693548387096774, 0.5241935483870968, 0.6209677419354839, 0.6451612903225806, 0.7419354838709677, 0.7580645161290323, 0.7661290322580645, 0.782258064516129, 0.782258064516129, 0.7983870967741935, 0.8709677419354839, 0.8790322580645161, 0.8145161290322581, 0.7903225806451613, 0.7903225806451613, 0.7661290322580645, 0.7580645161290323, 0.8064516129032258, 0.782258064516129, 0.782258064516129], "type": "scatter", "uid": "a52f3247-e5d1-4461-8d0b-7b51acd25dba"}, {"mode": "lines+markers", "name": "f1", "x": ["09:15:00", "09:30:00", "09:45:00", "10:00:00", "10:15:00", "10:30:00", "10:45:00", "11:00:00", "11:15:00", "11:30:00", "11:45:00", "12:00:00", "12:15:00", "12:30:00", "12:45:00", "13:00:00", "13:15:00", "13:30:00", "13:45:00", "14:00:00", "14:15:00", "14:30:00", "14:45:00", "15:00:00", "15:15:00", "15:30:00", "15:45:00", "16:00:00"], "y": [0.22651255983863902, 0.2760696903954044, 0.2973480825415976, 0.35120510451240783, 0.4258786822717823, 0.3972577642323899, 0.45224758992114134, 0.4204089150766008, 0.5269363933389183, 0.5220383590079418, 0.5579215334789055, 0.5881856875747317, 0.6194799843191933, 0.6204136974144098, 0.6506360704736117, 0.702849068806033, 0.6759091150004224, 0.6850721171035058, 0.7247836256167466, 0.7439784863538842, 0.7112184124483929, 0.6999506565397227, 0.7075317789254042, 0.7062700108206044, 0.6811099384824217, 0.7091705884036595, 0.7158175222665353, 0.6854631358012988], "type": "scatter", "uid": "d96095a5-49e7-4ac1-9efc-9f981121a473"}], {"title": {"text": "Precision, recall, F1 score for model 'optimised_02'"}, "xaxis": {"ticklen": 5, "title": {"text": "Prediction time in the day"}, "zeroline": false}, "yaxis": {"ticklen": 5, "title": {"text": "Percentage"}, "zeroline": false}}, {"showLink": false, "linkText": "Export to plot.ly", "plotlyServerURL": "https://plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("18d7f961-d11a-4f4f-8528-ee9d383bc946"));});</script></div>

In the end we wanted to look at the model's performance in different times in the day. As expected, the model's performance increases as more data is available during the day, reaching an estimated 60% recall at 11am, and 75% at 12:15am. 

## Way forward

The next step for this project is using Ensambling techniques to further increase the performance, such as Boosting and Bagging. These tools should take as input multiple neural nets and decision trees. Once this is done, we can take the project to production.

